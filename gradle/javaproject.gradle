// custom tasks for creating source jar
task sourcesJar(type: Jar, dependsOn:classes) {
    classifier = 'sources'
    from sourceSets.main.allSource
}
// custom tasks for creating javadoc jar
task javadocJar(type: Jar, dependsOn:"javadoc") {
    classifier = 'javadoc'
    from javadoc.destinationDir
}
// custom tasks for creating test jar
task testJar(type: Jar) {
    classifier = 'tests'
    from sourceSets.test.output
}

/**
 * Write a properties file that contains version and build information
 */
task writeBuildProperties(type:Copy){
    File bp = file("${sourceSets.main.output.resourcesDir.absolutePath}/${project.name}-build.properties")
    if(!bp.exists()){
        bp.getParentFile().mkdirs();
        bp.createNewFile();
    }else{
        // delete old
        bp.delete()
        bp.createNewFile();
    }
    bp.append("flux.version=${version}\n")
    if(project(":").appVersions[project.name]){
        bp.append("flux.appversion=${project(":").appVersions[project.name]}\n")
    }
    if(project(":").appNames[project.name]){
        bp.append("flux.appname=${project(":").appNames[project.name]}\n")
    }
    bp.append("build.date=${buildDate}\n")
    bp.append("build.version=${gitVersion}\n")
    bp.append("build.branch=${gitBranch}\n")
}
tasks.classes.dependsOn tasks.writeBuildProperties

task(versionInfo) << {
    description "Print version info"
    println "${project.name} Version info"
    println "Flux Lib:\t${version}"
    if(project(":").applications[project.name]){
        println "Flux App:\t${project(':').applications[project.name]}"
    }
    println "Build Date:\t${buildDate}"
    println "Build Version:\t${gitVersion}"
    println "Build Branch:\t${gitBranch}"
    println ""
}


configurations {
//    tests
    sjar
    jdoc
}

// add the jars as artifacts
artifacts {
    archives sourcesJar
    archives javadocJar
//    archives testJar
}